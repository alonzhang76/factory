<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>炉架订单生产计划执行表</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft Yahei", Arial, sans-serif;
        }
        body {
            padding: 20px;
            background-color: #f5f7fa;
        }
        .plan-container {
            max-width: 1400px;
            margin: 0 auto;
            background: #fff;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        .plan-header {
            text-align: center;
            margin-bottom: 25px;
            border-bottom: 2px solid #2c3e50;
            padding-bottom: 15px;
        }
        .plan-header h1 {
            color: #2c3e50;
            font-size: 24px;
            margin-bottom: 10px;
        }
        .base-info {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        .base-info .info-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .base-info .info-item label {
            font-weight: 600;
            color: #34495e;
            min-width: 80px;
        }
        .base-info .info-item input {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            width: 200px;
        }
        .base-info .info-item input.auto-width {
            width: auto;
            min-width: 200px;
            max-width: 100%;
        }
        .base-info .info-item .editable {
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            min-width: 200px;
            cursor: pointer;
            display: inline-block;
            word-wrap: break-word;
            max-width: 100%;
        }
        .base-info .info-item .editable:hover {
            border-color: #3498db;
        }
        .base-info .info-item .editable.editing {
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
            cursor: text;
        }
        .plan-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
            white-space: nowrap;
        }
        .plan-table th, .plan-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: center;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        .plan-table th {
            background-color: #2c3e50;
            color: #fff;
            font-weight: 600;
            position: sticky;
            top: 0;
        }
        .plan-table tr:nth-child(even) {
            background-color: #f8f9fa;
        }
        .plan-table input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
        }
        .plan-table input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52, 152, 219, 0.2);
        }
        .add-row-btn {
            margin-top: 15px;
            padding: 10px 20px;
            background-color: #3498db;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
        }
        .add-row-btn:hover {
            background-color: #2980b9;
        }
        @media (max-width: 768px) {
            .base-info {
                flex-direction: column;
                gap: 15px;
            }
            .plan-table {
                font-size: 12px;
            }
            .plan-table th, .plan-table td {
                padding: 8px 5px;
            }
        }
    </style>
</head>
<body>
    <div class="plan-container">
        <!-- 表头 -->
        <div class="plan-header main-header">
            <h1>炉架订单生产计划执行表</h1>
        </div>

        <!-- 基础信息 -->
        <div class="base-info">
            <div style="display: flex; gap: 20px; margin-bottom: 10px; width: 100%;">
                <div class="info-item">
                    <label>生产月份：</label>
                    <input type="month" id="productionMonth">
                    <script>
                        // 设置生产月份默认值为当前日期的下一个月
                        const now = new Date();
                        const nextMonth = new Date(now.getFullYear(), now.getMonth() + 1, 1);
                        const year = nextMonth.getFullYear();
                        const month = String(nextMonth.getMonth() + 1).padStart(2, '0');
                        document.getElementById('productionMonth').value = `${year}-${month}`;
                    </script>
                </div>
                <div class="info-item" style="margin-left: auto;">
                    <label>执行要求：</label>
                    <div id="executionReq" class="editable" ondblclick="makeEditable(this)">电镀工艺严格遵循双方确认标准</div>
                </div>
            </div>
            <div style="display: flex; gap: 20px; width: 100%;">
                <div class="info-item">
                    <label>电镀厂：</label>
                    <select id="electroplatingFactory" style="padding: 6px 10px; border: 1px solid #ddd; border-radius: 4px; width: 200px;">
                        <option value="安徽沃新">安徽沃新</option>
                        <option value="丹阳裕丰" selected>丹阳裕丰</option>
                    </select>
                </div>
                <div class="info-item">
                    <label>委托单位：</label>
                    <div id="entrustUnit" class="editable" ondblclick="makeEditable(this)">普利美（常州）环境工程科技有限公司</div>
                </div>
                <div class="info-item">
                    <label>对接人：</label>
                    <div id="contactPerson" class="editable" ondblclick="makeEditable(this)">许小成 15295020921</div>
                </div>
            </div>
            <div style="margin-top: 10px; padding: 10px 0; border-top: 1px solid #eee; font-weight: 600; color: #34495e;">
                报废/备用共预留0.3%
            </div>
        </div>

        <!-- 计划表表格 -->
        <table class="plan-table" id="planTable">
            <thead>
                <tr>
                    <th>序号</th>
                    <th>客户名称</th>
                    <th>订单编号</th>
                    <th>图纸编号</th>
                    <th>产品</th>
                    <th>规格</th>
                    <th>成品数量（只）</th>
                    <th>镀层标准（um/mV）</th>
                    <th>交货期</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>1</td>
                    <td><input type="text" class="customer"></td>
                    <td><input type="text" class="orderNo"></td>
                    <td><input type="text" class="drawingNo"></td>
                    <td><input type="text" class="productName"></td>
                    <td><input type="text" class="spec"></td>
                    <td><input type="number" class="finishedQty"></td>
                    <td><input type="text" class="platingStandard" value="≧18/180"></td>
                    <td><input type="date" class="finishedDeliverDate"></td>
                    <td><button onclick="deleteRow(this)" style="padding: 4px 8px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">删除</button></td>
                </tr>
            </tbody>
        </table>

        <!-- 打印日期 -->
        <div class="print-date" style="display: none;">
            打印日期：<span id="printDate"></span>
        </div>

        <!-- 按钮区域 -->
        <div style="margin-top: 15px; display: flex; gap: 10px;">
            <button class="add-row-btn" onclick="addTableRow()">+ 添加一行</button>
            <button class="add-row-btn" style="background-color: #27ae60;" onclick="printAndSave()">打印并保存</button>
        </div>
    </div>

    <!-- 计划明细表 -->
    <div class="plan-container" style="margin-top: 30px;">
        <div class="plan-header detail-header">
            <h1>计划明细表</h1>
        </div>
        <div style="margin-bottom: 10px; text-align: right;">
            <button onclick="clearDetailTable()" style="padding: 6px 12px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer;">清空</button>
        </div>
        <table class="plan-table" id="detailTable">
            <thead>
                <tr>
                    <th><input type="checkbox" id="selectAll" onchange="toggleSelectAll()"></th>
                    <th>生产月份</th>
                    <th>电镀厂</th>
                    <th>序号</th>
                    <th>客户名称</th>
                    <th>订单编号</th>
                    <th>图纸编号</th>
                    <th>产品</th>
                    <th>规格</th>
                    <th>成品数量（只）</th>
                    <th>镀层标准（um/mV）</th>
                    <th>交货期</th>
                </tr>
            </thead>
            <tbody>
                <!-- 数据将通过JavaScript动态添加 -->
            </tbody>
        </table>
    </div>

    <script>
        // 添加新行
        function addTableRow() {
            const tableBody = document.querySelector('#planTable tbody');
            const lastRow = tableBody.lastElementChild;
            const lastIndex = parseInt(lastRow.cells[0].innerText);
            const newIndex = lastIndex + 1;

            // 创建新行
            const newRow = document.createElement('tr');
            newRow.innerHTML = `
                <td>${newIndex}</td>
                <td><input type="text" class="customer"></td>
                <td><input type="text" class="orderNo"></td>
                <td><input type="text" class="drawingNo"></td>
                <td><input type="text" class="productName"></td>
                <td><input type="text" class="spec"></td>
                <td><input type="number" class="finishedQty"></td>
                <td><input type="text" class="platingStandard" value="≧18/180"></td>
                <td><input type="date" class="finishedDeliverDate"></td>
                <td><button onclick="deleteRow(this)" style="padding: 4px 8px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">删除</button></td>
            `;
            tableBody.appendChild(newRow);
        }

        // 删除行
        function deleteRow(button) {
            const row = button.closest('tr');
            const tableBody = row.closest('tbody');
            
            // 确认删除
            if (confirm('确定要删除这一行吗？')) {
                row.remove();
                
                // 重新编号
                const rows = tableBody.querySelectorAll('tr');
                rows.forEach((row, index) => {
                    row.cells[0].innerText = index + 1;
                });
            }
        }

        // 双击编辑功能
        function makeEditable(element) {
            if (element.classList.contains('editing')) {
                return;
            }

            const currentValue = element.innerText;
            element.classList.add('editing');
            
            // 创建textarea元素
            const textarea = document.createElement('textarea');
            textarea.value = currentValue;
            textarea.style.width = '100%';
            textarea.style.minWidth = '200px';
            textarea.style.maxWidth = '100%';
            textarea.style.height = 'auto';
            textarea.style.minHeight = '36px';
            textarea.style.padding = '6px 10px';
            textarea.style.border = '1px solid #3498db';
            textarea.style.borderRadius = '4px';
            textarea.style.boxShadow = '0 0 0 2px rgba(52, 152, 219, 0.2)';
            textarea.style.fontFamily = 'inherit';
            textarea.style.fontSize = 'inherit';
            textarea.style.resize = 'vertical';
            
            // 替换div为textarea
            element.innerHTML = '';
            element.appendChild(textarea);
            
            // 自动聚焦并全选内容
            textarea.focus();
            textarea.select();
            
            // 添加保存事件
            textarea.addEventListener('blur', () => saveEditable(element, textarea.value));
            textarea.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    saveEditable(element, textarea.value);
                } else if (e.key === 'Escape') {
                    e.preventDefault();
                    element.innerText = currentValue;
                    element.classList.remove('editing');
                }
            });
        }

        // 保存编辑内容
        function saveEditable(element, value) {
            element.innerText = value.trim() || element.innerText;
            element.classList.remove('editing');
        }

        // 保存到计划明细表
        function saveToDetailTable() {
            // 获取生产月份和电镀厂
            const productionMonth = document.getElementById('productionMonth').value;
            const electroplatingFactory = document.getElementById('electroplatingFactory').value;

            // 检查必填项
            if (!productionMonth) {
                alert('请选择生产月份');
                return;
            }

            // 获取上方表格的所有行
            const planTable = document.getElementById('planTable');
            const planRows = planTable.querySelectorAll('tbody tr');
            const detailTableBody = document.getElementById('detailTable').querySelector('tbody');

            // 遍历每行数据
            planRows.forEach((row, index) => {
                // 获取行内所有输入值
                const customer = row.querySelector('.customer').value;
                const orderNo = row.querySelector('.orderNo').value;
                const drawingNo = row.querySelector('.drawingNo').value;
                const productName = row.querySelector('.productName').value;
                const spec = row.querySelector('.spec').value;
                const finishedQty = row.querySelector('.finishedQty').value;
                const platingStandard = row.querySelector('.platingStandard').value;
                const finishedDeliverDate = row.querySelector('.finishedDeliverDate').value;

                // 至少有一个输入值才保存
                if (customer || drawingNo || productName || spec || finishedQty || finishedDeliverDate) {
                    // 创建新行
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td><input type="checkbox" onchange="handleCheckboxChange(this)"></td>
                        <td>${productionMonth}</td>
                        <td>${electroplatingFactory}</td>
                        <td>${index + 1}</td>
                        <td>${customer}</td>
                        <td>${orderNo}</td>
                        <td>${drawingNo}</td>
                        <td>${productName}</td>
                        <td>${spec}</td>
                        <td>${finishedQty}</td>
                        <td>${platingStandard}</td>
                        <td>${finishedDeliverDate}</td>
                    `;
                    detailTableBody.appendChild(newRow);
                }
            });

            alert('数据已保存到计划明细表');
        }

        // 清空上方表格
        function clearPlanTable() {
            const planRows = document.querySelectorAll('#planTable tbody tr');
            planRows.forEach(row => {
                // 清空输入值，保留默认值
                row.querySelector('.customer').value = '';
                row.querySelector('.orderNo').value = '';
                row.querySelector('.drawingNo').value = '';
                row.querySelector('.productName').value = '';
                row.querySelector('.spec').value = '';
                row.querySelector('.finishedQty').value = '';
                // 保留镀层标准默认值
                row.querySelector('.finishedDeliverDate').value = '';
            });
        }
        
        // 将计划明细表数据保存到localStorage
        function saveDetailTableToLocalStorage() {
            const detailTableBody = document.querySelector('#detailTable tbody');
            const rows = detailTableBody.querySelectorAll('tr');
            const data = [];
            
            rows.forEach((row, index) => {
                const cells = row.querySelectorAll('td');
                data.push({
                    id: index + 1,
                    productionMonth: cells[1].textContent, // 索引+1，因为添加了复选框列
                    electroplatingFactory: cells[2].textContent,
                    serialNumber: cells[3].textContent,
                    customer: cells[4].textContent,
                    orderNo: cells[5].textContent,
                    drawingNo: cells[6].textContent,
                    productName: cells[7].textContent,
                    spec: cells[8].textContent,
                    finishedQty: cells[9].textContent,
                    platingStandard: cells[10].textContent,
                    deliveryDate: cells[11].textContent
                });
            });
            
            // 保存到localStorage
            localStorage.setItem('platingPlanDetailTable', JSON.stringify(data));
        }
        
        // 页面加载时从localStorage恢复计划明细表数据
        function loadDetailTableFromLocalStorage() {
            const data = localStorage.getItem('platingPlanDetailTable');
            if (data) {
                const rows = JSON.parse(data);
                const detailTableBody = document.querySelector('#detailTable tbody');
                
                rows.forEach(rowData => {
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td><input type="checkbox" onchange="handleCheckboxChange(this)"></td>
                        <td>${rowData.productionMonth}</td>
                        <td>${rowData.electroplatingFactory}</td>
                        <td>${rowData.serialNumber}</td>
                        <td>${rowData.customer}</td>
                        <td>${rowData.orderNo}</td>
                        <td>${rowData.drawingNo}</td>
                        <td>${rowData.productName}</td>
                        <td>${rowData.spec}</td>
                        <td>${rowData.finishedQty}</td>
                        <td>${rowData.platingStandard}</td>
                        <td>${rowData.deliveryDate}</td>
                    `;
                    detailTableBody.appendChild(newRow);
                });
            }
        }
        
        // 清空计划明细表
        function clearDetailTable() {
            const detailTableBody = document.querySelector('#detailTable tbody');
            detailTableBody.innerHTML = '';
            saveDetailTableToLocalStorage(); // 更新localStorage
        }
        
        // 全选/取消全选功能
        function toggleSelectAll() {
            const selectAllCheckbox = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('#detailTable tbody input[type="checkbox"]');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
            });
            
            // 如果是全选状态，回填第一条记录
            if (selectAllCheckbox.checked && checkboxes.length > 0) {
                fillDataBack(checkboxes[0]);
            }
        }
        
        // 处理单个复选框变化
        function handleCheckboxChange(checkbox) {
            // 检查是否有未选中的复选框，如果有则取消全选
            const checkboxes = document.querySelectorAll('#detailTable tbody input[type="checkbox"]');
            const selectAllCheckbox = document.getElementById('selectAll');
            selectAllCheckbox.checked = Array.from(checkboxes).every(cb => cb.checked);
            
            // 只要复选框被选中，就进行数据回填
            if (checkbox.checked) {
                fillDataBack(checkbox);
            }
        }
        
        // 数据回填功能
        function fillDataBack(checkbox) {
            const row = checkbox.closest('tr');
            const cells = row.querySelectorAll('td');
            
            // 获取数据（注意索引从3开始，因为第0列是复选框，1是生产月份，2是电镀厂）
            const serialNumber = cells[3].textContent;
            const customer = cells[4].textContent;
            const orderNo = cells[5].textContent;
            const drawingNo = cells[6].textContent;
            const productName = cells[7].textContent;
            const spec = cells[8].textContent;
            const finishedQty = cells[9].textContent;
            const platingStandard = cells[10].textContent;
            const finishedDeliverDate = cells[11].textContent;
            
            // 清空上方表格的第一行
            const planTableBody = document.querySelector('#planTable tbody');
            const firstRow = planTableBody.querySelector('tr');
            if (firstRow) {
                firstRow.querySelectorAll('input, select').forEach(input => {
                    if (input.type === 'checkbox') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
            }
            
            // 回填数据到上方表格的第一行（使用class选择器）
            firstRow.querySelector('input.customer').value = customer;
            firstRow.querySelector('input.orderNo').value = orderNo;
            firstRow.querySelector('input.drawingNo').value = drawingNo;
            firstRow.querySelector('input.productName').value = productName;
            firstRow.querySelector('input.spec').value = spec;
            firstRow.querySelector('input.finishedQty').value = finishedQty;
            firstRow.querySelector('input.platingStandard').value = platingStandard;
            firstRow.querySelector('input.finishedDeliverDate').value = finishedDeliverDate;
        }
        
        // 打印功能
        function printPlan() {
            // 创建打印样式
            const printStyle = document.createElement('style');
            printStyle.id = 'print-style';
            printStyle.textContent = `
                @media print {
                    /* 隐藏不需要打印的元素 */
                    #detailTable, .detail-header, .add-row-btn, button[onclick="deleteRow(this)"], button[onclick="clearDetailTable()"] {
                        display: none !important;
                    }
                    
                    /* 隐藏操作列 */
                    .plan-table th:nth-child(10), .plan-table td:nth-child(10) {
                        display: none !important;
                    }
                    
                    /* 设置A4横向排版 */
                    @page {
                        size: A4 landscape;
                        margin: 1cm;
                    }
                    
                    /* 确保内容在一页内 */
                    .plan-container {
                        max-width: 100%;
                        box-shadow: none;
                        padding: 0;
                    }
                    
                    /* 优化表格打印 */
                    .plan-table {
                        width: 100%;
                        border-collapse: collapse;
                        font-size: 12px;
                    }
                    
                    .plan-table th, .plan-table td {
                        border: 1px solid #000;
                        padding: 5px;
                        text-align: center;
                    }
                    
                    /* 确保输入框内容打印 */
                    input {
                        border: none;
                        background: transparent;
                    }
                    
                    /* 打印日期样式 */
                    .print-date {
                        display: block !important;
                        text-align: right;
                        margin-top: 20px;
                        font-weight: bold;
                    }
                    
                    /* 委托单位样式 - 不换行并可缩小字体 */
                    #entrustUnit {
                        white-space: nowrap !important;
                        font-size: smaller !important;
                        overflow: hidden;
                        text-overflow: ellipsis;
                    }
                }
            `;
            
            // 添加打印样式到页面
            document.head.appendChild(printStyle);
            
            // 监听打印状态变化
            const mediaQueryList = window.matchMedia('print');
            const handlePrintChange = (e) => {
                if (!e.matches) {
                    // 打印预览已关闭
                    setTimeout(() => {
                        // 清空表格
                        clearPlanTable();
                        // 移除事件监听
                        mediaQueryList.removeEventListener('change', handlePrintChange);
                    }, 500);
                }
            };
            
            // 添加事件监听
            mediaQueryList.addEventListener('change', handlePrintChange);
            
            // 设置打印日期
            const today = new Date();
            const formattedDate = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0') + '-' + String(today.getDate()).padStart(2, '0');
            document.getElementById('printDate').textContent = formattedDate;
            
            // 执行打印
            window.print();
            
            // 移除打印样式
            setTimeout(() => {
                document.head.removeChild(printStyle);
            }, 100);
        }
        
        // 打印并保存功能
        function printAndSave() {
            // 获取生产月份
            const productionMonth = document.getElementById('productionMonth').value;
            
            // 检查生产月份是否已选择
            if (!productionMonth) {
                alert('请选择生产月份');
                return;
            }
            
            // 检查订单编号是否重复
            const planTable = document.getElementById('planTable');
            const planRows = planTable.querySelectorAll('tbody tr');
            const detailTableBody = document.getElementById('detailTable').querySelector('tbody');
            const existingRows = detailTableBody.querySelectorAll('tr');
            
            // 收集现有明细表中的订单编号
            const existingOrderNos = new Set();
            existingRows.forEach(row => {
                const orderNo = row.querySelector('td:nth-child(6)').textContent; // 订单编号在第6列
                if (orderNo) {
                    existingOrderNos.add(orderNo);
                }
            });
            
            // 检查当前要保存的订单是否有重复
            let hasDuplicate = false;
            let duplicateOrderNos = [];
            
            planRows.forEach(row => {
                const orderNo = row.querySelector('.orderNo').value;
                if (orderNo && existingOrderNos.has(orderNo)) {
                    hasDuplicate = true;
                    duplicateOrderNos.push(orderNo);
                }
            });
            
            // 如果有重复订单编号
            if (hasDuplicate) {
                alert(`订单编号 ${duplicateOrderNos.join('、')} 已存在于计划明细表中，只打印不保存`);
                // 执行打印但不保存
                printPlan();
            } else {
                // 先保存到明细表
                saveToDetailTable();
                
                // 保存到localStorage
                saveDetailTableToLocalStorage();
                
                // 执行打印
                printPlan();
            }
        }
        
        // 从URL参数中获取订单数据并填充到表格
        function loadOrdersFromUrl() {
            // 获取URL参数
            const urlParams = new URLSearchParams(window.location.search);
            const ordersParam = urlParams.get('orders');
            
            if (!ordersParam) {
                return; // 没有订单数据，直接返回
            }
            
            try {
                // 解析订单数据
                const orders = JSON.parse(decodeURIComponent(ordersParam));
                
                if (!Array.isArray(orders) || orders.length === 0) {
                    return;
                }
                
                // 清空现有行（保留一行用于填充）
                const planTableBody = document.querySelector('#planTable tbody');
                planTableBody.innerHTML = '';
                
                // 根据订单数量添加行并填充数据
                orders.forEach((order, index) => {
                    // 格式化交货期为YYYY-MM-DD格式
                    let formattedDeliveryDate = '';
                    if (order.deliveryDate) {
                        try {
                            const date = new Date(order.deliveryDate);
                            if (!isNaN(date.getTime())) {
                                const year = date.getFullYear();
                                const month = String(date.getMonth() + 1).padStart(2, '0');
                                const day = String(date.getDate()).padStart(2, '0');
                                formattedDeliveryDate = `${year}-${month}-${day}`;
                            } else {
                                formattedDeliveryDate = order.deliveryDate;
                            }
                        } catch (e) {
                            formattedDeliveryDate = order.deliveryDate;
                        }
                    }
                    
                    // 创建新行
                    const newRow = document.createElement('tr');
                    newRow.innerHTML = `
                        <td>${index + 1}</td>
                        <td><input type="text" class="customer" value="${order.customer || ''}"></td>
                        <td><input type="text" class="orderNo" value="${order.orderId || ''}"></td>
                        <td><input type="text" class="drawingNo" value="${order.remark || ''}"></td>
                        <td><input type="text" class="productName" value="${order.product || ''}"></td>
                        <td><input type="text" class="spec"></td>
                        <td><input type="number" class="finishedQty" value="${order.quantity || ''}"></td>
                        <td><input type="text" class="platingStandard" value="≧18/180"></td>
                        <td><input type="date" class="finishedDeliverDate" value="${formattedDeliveryDate}"></td>
                        <td><button onclick="deleteRow(this)" style="padding: 4px 8px; background-color: #e74c3c; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 12px;">删除</button></td>
                    `;
                    planTableBody.appendChild(newRow);
                });
            } catch (error) {
                console.error('解析订单数据失败:', error);
                alert('加载订单数据失败，请重试！');
            }
        }
        
        // 页面加载完成后自动加载URL中的订单数据和恢复本地存储的数据
        document.addEventListener('DOMContentLoaded', function() {
            loadOrdersFromUrl();
            loadDetailTableFromLocalStorage();
        });
    </script>
</body>
</html>
